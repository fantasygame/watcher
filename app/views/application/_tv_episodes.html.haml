.episodes
  - tvs.each do |tv|
    %table.table
      %tr
        %th
          = link_to tv_path(id: tv.id) do
            != logo_image_path(tv.poster_path, 1, tv.name)
        %th{style: 'vertical-align: middle'}= link_to tv.name, tv_path(id: tv.id)
        %th{colspan: 2, style: 'vertical-align: middle'}
          = link_to 'Set all episodes as seen', set_all_views_path(tv_id: tv.id), remote: :true, class: 'toggle-all btn btn-default'
          = link_to 'Set all episodes as unseen', unset_all_views_path(tv_id: tv.id), remote: :true, class: 'toggle-all btn btn-default'
      - tv.seasons.each do |season|
        = render partial: 'season_episodes', locals: { tv: tv, season: season }
- content_for :js do
  :javascript
    $(function(){
      $('.toggle-seen').on('ajax:success',function(event, data, status, xhr){
        if (status == 'success') {
          episode = $('.episode-' + data.episode_id);
          button = episode.find('.toggle-seen');
          if(data.created) {
            episode.addClass('seen-episode');
            button.html('Set as unseen');
          } else {
            episode.removeClass('seen-episode');
            button.html('Set as seen');
          }
        }
      });

      $('.toggle-all').on('ajax:success',function(event, data, status, xhr) {
        if (data.season_id) {
          episodes = $('.tv-' + data.tv_id + '.season-' + data.season_id);
        } else {
          episodes = $('.tv-' + data.tv_id);
        }
        buttons = episodes.find('.toggle-seen');
        if(data.set_all) {
          episodes.addClass('seen-episode');
          buttons.html('Set as unseen');
        } else {
          episodes.removeClass('seen-episode');
          buttons.html('Set as seen');
        }
      });
    });
